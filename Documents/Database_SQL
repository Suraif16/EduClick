#creating database

CREATE DATABASE EduClickDB;

USE EduClickDB;

CREATE TABLE Users(
    UserID BIGINT NOT NULL,
    FirstName VARCHAR(50) NOT NULL,
    LastName VARCHAR(50) NOT NULL,
    ProfilePic BIGINT,
    DOB DATE NOT NULL,
    MobileNum INT,
    UserType ENUM('Student','Teacher') NOT NULL,
    Country VARCHAR(50),
    PRIMARY KEY(UserID)
    );

CREATE TABLE Student(
    UserID BIGINT UNIQUE NOT NULL,
    School VARCHAR(200),
    GRADE INT NOT NULL,
    );

CREATE TABLE Teacher(
    UserID BIGINT UNIQUE NOT NULL,
    CurrentWorkingPlace VARCHAR(300),
    );

CREATE TABLE Classroom_has_EPost(
    ClassroomID BIGINT NOT NULL,
    EPostID BIGINT NOT NULL,
    CONSTRAINT PK_Classroom_has_EPost PRIMARY KEY(ClassroomID,EPostID)**
    );

CREATE TABLE Classroom(
    ClassroomID BIGINT NOT NULL,
    CR_Name VARCHAR(100) NOT NULL,
    CR_Code VARCHAR(30) UNIQUE NOT NULL,
    Year YEAR,
    Grade INT,
    Subject VARCHAR(100),
    UserID BIGINT NOT NULL,
    PRIMARY KEY(ClassroomID)
    );

CREATE TABLE Login(
    EmailID BIGINT NOT NULL,
    Password CHAR(64) NOT NULL,
    LoginTime TIME NOT NULL,
    UserID BIGINT NOT NULL,
    PRIMARY KEY(EmailID)
    );

CREATE TABLE Enroll(
    UserID BIGINT NOT NULL,
    ClassroomID BIGINT NOT NULL,
    Status ENUM('Enable','Disable') NOT NULL,
    CONSTRAINT PK_Enroll PRIMARY KEY(UserID,ClassroomID)**
    );

CREATE TABLE Answer_Student_Post_Relationship(
    St_UserID BIGINT NOT NULL,
    AnswerID BIGINT NOT NULL,
    EPostID BIGINT NOT NULL,
    CONSTRAINT PK_Ans_Stu_Post PRIMARY KEY(St_UserID,AnswerID,EPostID)**
    );

CREATE TABLE Answer(
    AnswerID BIGINT NOT NULL,
    Date DATE NOT NULL,
    Time TIME NOT NULL,
    Marks INT,
    PRIMARY KEY(AnswerID)
    );

CREATE TABLE EDW_Answers(
    AnswerID BIGINT NOT NULL,
    Content TEXT,
    ImagePath BIGINT,
    PRIMARY KEY(AnswerID)
    );

CREATE TABLE Question(
	QuestionID BIGINT NOT NULL,
	Correct_answers TEXT,
	EPostID BIGINT NOT NULL,
	PRIMARY KEY(QuestionID)
	);

CREATE TABLE Question_answer_value(
	QuestionID BIGINT NOT NULL,
	Answer_no ENUM('1','2','3','4') NOT NULL,
	Answer TEXT NOT NULL,
	CONSTRAINT PK_Question_answer_value PRIMARY KEY(QuestionID,Answer_no)
	);


CREATE TABLE RemoveEntity(
	ReportID BIGINT NOT NULL,
	EmailID BIGINT NOT NULL,
	PRIMARY KEY(ReportID)
	);


CREATE TABLE Report(
	ReportID BIGINT NOT NULL,
	Count INT NOT NULL,
	Report_delete_flag BOOLEAN NOT NULL,
	UserID BIGINT,
	AnswerID BIGINT,
	NF_postID BIGINT,
	EpostID BIGINT,
	PRIMARY KEY(ReportID)
	);

CREATE TABLE User_makes_report(
	UserID BIGINT NOT NULL,
	ReportID BIGINT NOT NULL,
	PRIMARY KEY(UserID)
	);

CREATE TABLE Qualifications(
	UserID BIGINT NOT NULL,
	Qualification VARCHAR(200),
	CONSTRAINT PK_Qualifications PRIMARY KEY(UserID,Qualification)**
	);

CREATE TABLE Add_friends(
	UserID BIGINT NOT NULL,
	Friend_UserID BIGINT NOT NULL,
	CONSTRAINT PK_Add_friends KEY(UserID, Friend_UserID)**
	);

CREATE TABLE Follows(
	S_UserID BIGINT NOT NULL,
	T_UserID BIGINT NOT NULL,
	CONSTRAINT PK_Follows KEY(S_UserID, T_UserID)**
	);

CREATE TABLE News_feed_image(
	NFPostID BIGINT NOT NULL,
	ImagePath BIGINT NOT NULL,
	CONSTRAINT PK_News_feed_image KEY(NFPostID,ImagePath)
	);

CREATE TABLE Admin(
	EmailID BIGINT NOT NULL,
	Password CHAR(64) NOT NULL,
	AdminName VARCHAR(50), NOT NULL
	PRIMARY KEY(EmailID)
	);

CREATE TABLE educationalpost(
	EPostID BIGINT NOT NULL,
	Date DATE NOT NULL,
	Time TIME NOT NULL,
	EPtype ENUM('EducationalWork','MCQ') NOT NULL,
	PRIMARY KEY(EPostID)
	);

CREATE TABLE educationalWork(
	EPostID BIGINT UNIQUE NOT NULL,
	ImagePath BIGINT,
	Caption TEXT
	);

CREATE TABLE likes(
	St_UserID BIGINT NOT NULL,
	NFPostID BIGINT NOT NULL,
	CONSTRAINT PK_likes PRIMARY KEY(St_UserID,NFPostID)
	);

CREATE TABLE mcq(
	EPostID BIGINT UNIQUE NOT NULL,
	Caption TEXT
	);

CREATE TABLE mcq_answers(
	AnswerID BIGINT NOT NULL,
	Choice ENUM('1','2','3','4') NOT NULL,
	QuestionID BIGINT NOT NULL,
	PRIMARY KEY(AnswerID)
	);

CREATE TABLE newsfeeds(
	EPostID BIGINT NOT NULL,
	Date DATE NOT NULL,
	Time TIME NOT NULL,
	Caption TEXT,
	PRIMARY KEY(EPostID)
	);

CREATE TABLE posts(
	T_UserID BIGINT NOT NULL,
	St_UserID BIGINT NOT NULL,
	NFPostID BIGINT NOT NULL,
	CONSTRAINT PK_posts PRIMARY KEY(T_UserID,St_UserID,NFPostID)**
	);

CREATE TABLE subject(
	UserID BIGINT NOT NULL,
	Subject VARCHAR(40),
	CONSTRAINT PK_subject PRIMARY KEY(UserID,Subject)**
	);


ALTER TABLE STUDENT
   ADD FOREIGN KEY(UserID) REFERENCES Users(UserID)
   ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE TEACHER
   ADD FOREIGN KEY(UserID) REFERENCES Users(UserID)
   ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE Classroom_has_EPost
   ADD FOREIGN KEY(ClassroomID) REFERENCES Classroom(ClassroomID) ON UPDATE CASCADE ON DELETE CASCADE,
   ADD FOREIGN KEY(EPostID) REFERENCES educationalpost(EPostID) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE Login
   ADD FOREIGN KEY(UserID) REFERENCES Users(UserID) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE Classroom
   ADD FOREIGN KEY(UserID) REFERENCES Teacher(UserID) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE Enroll
   ADD FOREIGN KEY(UserID) REFERENCES Users(UserID) ON UPDATE CASCADE ON DELETE CASCADE,
   ADD FOREIGN KEY(ClassroomID) REFERENCES Classroom(ClassroomID) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE answer_student_post_relationship
   ADD FOREIGN KEY(St_UserID) REFERENCES Student(UserID) ON UPDATE CASCADE ON DELETE CASCADE,
   ADD FOREIGN KEY(AnswerID) REFERENCES Answer(AnswerID) ON UPDATE CASCADE ON DELETE CASCADE,
   ADD FOREIGN KEY(EPostID) REFERENCES educationalpost(EPostID) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE EDW_Answers
   ADD FOREIGN KEY(AnswerID) REFERENCES Answer(AnswerID) ON UPDATE CASCADE ON DELETE CASCADE;
